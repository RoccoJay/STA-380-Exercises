---
title: "Association Rule Mining"
author: "Robbie Geoghegan"
date: "8/17/2019"
output:
  word_document: default
  pdf_document: default
  html_document: default
---

```{r echo=FALSE}
library(tidyverse)
library(arules) 
library(arulesViz)
library(plyr) #splitting, applying and combining data
library(ggplot2)
library(knitr)
library(lubridate)
```


```{r echo = FALSE}
groceries = as.matrix(read.table("groceries.txt",
                                 header=FALSE,
                                 sep = "/"))
```

```{r} 
#change colname
colnames(groceries) <- c("items")
summary(groceries)
```

```{r echo = FALSE}
#create formate needed for basket analysis
write.csv(groceries, "C:/Users/geogh/Dropbox/1. UT/3. Predictive Modelling/Part 2 Project/market_basket_transactions.csv", quote=FALSE, row.names=FALSE)
```

```{r echo = FALSE}
#load in csv to analyze using read.transactions --> DON"T WORRY ABOUT ERROR MESSAGES
groc_tr <- read.transactions("C:/Users/geogh/Dropbox/1. UT/3. Predictive Modelling/Part 2 Project/market_basket_transactions.csv", format = "basket", sep = ",")
```

```{r echo = FALSE}
summary(groc_tr)
##This shows 13,633 transactions
#178 items (columns)
#density tells percentage of non-zero cells in the sparse matrix(most elements are zero). It is the total number of items that are purchases divided by the possible number of items in that matrix
#most frequent items are whole milk, other vegetables, buns, rolls and soda
#Numbers belwo show counts of baskets, 3,413 baskets have 1 item, 2,893 basekets have 2 items etc.
```

```{r echo = FALSE}
#Plot top 20 most purcahsed items
itemFrequencyPlot(groc_tr, topN=20)
itemFrequencyPlot(groc_tr, topN=20, type="absolute")
```

```{r echo = FALSE}
#set support, confidence and maxlen
association.rules <- apriori(groc_tr, parameter = list(supp=0.005, conf=0.1, maxlen=5))
```
```{r echo = FALSE}
#look at rules - too many
inspect(association.rules)
```
```{r echo = FALSE}
#look at a subset of rules
inspect(subset(association.rules, subset=lift > 1 & confidence > 0.5))
```
```{r echo = FALSE}
#plot lift and support
plot(association.rules) #confidence and support
plot(association.rules, measure = c("support", "lift"), shading = "confidence") #lift and support
plot(association.rules, method='two-key plot') #confidence and support based on order #
```

```{r echo = FALSE}
sub1 = subset(association.rules, subset=confidence > 0.1 & support > 0.01)
summary(sub1)
plot(sub1, method='graph')
```

```{r echo = FALSE}
#top 10 rules
sub_rules <- association.rules[quality(association.rules)$confidence>0.4] 
top10_sub_rules <- head(sub_rules, n=10, by = "lift")
plot(top10_sub_rules, method = "graph", engine = "htmlwidget")
```

```{r echo = FALSE}
#save top 1000 rules to use in Gephi
saveAsGraph(head(sub_rules, n=1000, by = "lift"), file = "groceries_gephi.graphml")
```

The data has a total of 13,633 transactions and 178 items
density tells percentage of non-zero cells in the sparse matrix(most elements are zero). It is the total number of items that are purchases divided by the possible number of items in that matrix
most frequent items are whole milk, other vegetables, buns, rolls and soda
Numbers belwo show counts of baskets, 3,413 baskets have 1 item, 2,893 basekets have 2 items etc.











