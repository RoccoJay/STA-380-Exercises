---
title: "Exercise 2: ABIA"
author: "Sebastian Osorio, Robbie Geoghegan"
date: "7/8/2019"
output: html_document
---
Everyone loves to travel but delays and crowds can ruin a trip. This analysis provides information for those people seeking to optimize their trips around busy times, days and months and which carriers to choose to avoid delays.


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Visual story telling part 2: flights at ABIA


```{r Data read, include = FALSE}
ABIA <- read.csv('ABIA.csv', header = TRUE)
ABIA <- ABIA[,c("Month","DayofMonth","DayOfWeek","DepTime","CRSDepTime","ArrTime","CRSArrTime","UniqueCarrier", "ArrDelay","DepDelay","Origin","Dest","Cancelled","CancellationCode")]
library(ggplot2)
```


```{r Data manipulation, include = FALSE}
#Unifying Arrivals and Departures for graphs:
ABIA$AUS[ABIA$Dest=="AUS"]="Arrivals"
ABIA$AUS[ABIA$Origin=="AUS"]="Departures"

#Extracting Hour of Day info from time columns:
ABIA$hour<-NA
ABIA$hour[ABIA$Dest=="AUS"]=ceiling(ABIA$ArrTime[ABIA$Dest=="AUS"]/100)
ABIA$hour[ABIA$Origin=="AUS"]=ceiling(ABIA$DepTime[ABIA$Origin=="AUS"]/100)

#Unifying the Departure and Arrival delays
ABIA$delay[ABIA$Dest=="AUS"]=ABIA$ArrDelay[ABIA$Dest=="AUS"]
ABIA$delay[ABIA$Origin=="AUS"]=ABIA$DepDelay[ABIA$Origin=="AUS"]
```



```{r Frequency Graphic: Hour of day vs Day of the Week,echo=FALSE}
ABIA_dow <- na.omit(ABIA[,c("AUS","delay","hour", "DayOfWeek")])
ABIA_hdxt <- xtabs(~hour + DayOfWeek + AUS, ABIA_dow)
ABIA_hdxt <- as.data.frame.table(ABIA_hdxt)

freqHD <- ggplot(ABIA_hdxt, aes(DayOfWeek, hour, fill = Freq)) + facet_grid(~AUS) + geom_tile() + ylab("Hour of the day") +xlab("Day of the Week") + ggtitle("Arrivals and Departures in Austin (Hour of the day / Day of the Week)") + scale_fill_gradient( trans="sqrt", low = "white", high="dark green")
freqHD  + scale_y_discrete(limits=rev(levels(ABIA_hdxt$hour)))
```
The above heatmap shows arrival and departure information by hour of the day and day of the week with Monday being day 1, Tuesday day 2 etc.. The early hours of the day before 6am are quiet but become the busiest of the day between 7am to 10am on weekdays. Saturday is the least busy of all days so is a great day to travel for someone to avoid crowds. A midday peak occurs between 12pm-1pm. Arrivals remain fairly equal through the afternoon while departures get busy again from 4pm until 8pm. 

```{r Frequency Graphic: Hour of day vs Month, echo=FALSE}
ABIA_hm <- na.omit(ABIA[,c("AUS","delay","hour", "Month")])
ABIA_hmxt <- xtabs(~hour + Month + AUS, ABIA_hm)
ABIA_hmxt <- as.data.frame.table(ABIA_hmxt)

freqHM <- ggplot(ABIA_hmxt, aes(Month, hour, fill = Freq)) + facet_grid(~AUS) + geom_tile() + ylab("Hour of the day") +xlab("Month") + ggtitle("Arrivals and Departures in Austin (Hour of the day / Month)") + scale_fill_gradient( trans="sqrt", low = "white", high="dark green")
freqHM  + scale_y_discrete(limits=rev(levels(ABIA_hmxt$hour)))
```
This heatmap shows the volume of arrivals and departures by month and hour of the day with Month 1 being January, Month 2 being February etc.. The busiest time for departures is consistently 7am to 10am throughout the year while arrivals time peaks are concentrated in times after 11am. For those looking to avoid crowds, Fall months appear to have fewer flights than other times of the year. 

```{r Frequency Graphic: Day of the Week vs Month, echo=FALSE}
ABIA_dm <- na.omit(ABIA[,c("AUS","delay","DayOfWeek", "Month")])
ABIA_dmxt <- xtabs(~DayOfWeek + Month + AUS, ABIA_dm)
ABIA_dmxt <- as.data.frame.table(ABIA_dmxt)

freqDM <- ggplot(ABIA_dmxt, aes(Month, DayOfWeek, fill = Freq)) + facet_grid(~AUS) + geom_tile() + ylab("Day of the Week") +xlab("Month") + ggtitle("Arrivals and Departures in Austin (Day of Week / Month)") + scale_fill_gradient( trans="sqrt", low = "white", high="dark green")
freqDM  + scale_y_discrete(limits=rev(levels(ABIA_dmxt$DayOfWeek)))
```
The above graph shows arrival and departure volumes for month and day of the week. Initially we thought the fact these were almost an exact match was an error, however what it shows is that approximatley the same number of flights that land each day depart that day. Saturday is again shown to have small volumes of fligths. This graph shouldn't be used for too much planning though because concentrations occur where months have 5 occurences of a day rather than 4 of others.

```{r, include = FALSE}
ABIA$delay_bin <- ifelse(ABIA$DepDelay > 0, "Delayed", "Not Delayed")
```


```{r, echo=FALSE}
# DABIA = subset(ABIA, ABIA$delay_bin!=is.null)
ggplot(data=na.omit(ABIA), mapping=aes(x=UniqueCarrier, y=..count.., fill=delay_bin, group=delay_bin)) +
  geom_bar(position = position_dodge(), color='black') +
  ggtitle("Volume of Departures that are Delayed or Not Delayed by Airline")
```
The above graph shows the total departures that are delayed (departure delay is greter than 0) and not delayed by Airline Carrier. We can see that WN (Southwest Airlines) provides the most flights from Austin and AA (American Airlines) is the second most. This may be useful when mitigating against flight cancellations - these airlines are more likely to have other flights that a passenger can be moved to. Very interestingly, Southwest Airlines has the most flights and the highest proportion of departure delays - with more flights being delayed than not. Conversley, American Airlines has one of the highest proportion of departures that are not delayed. A commuter who wants to avoid delays and mitigate against cancellation risks should choose American Airlines. Other good options to avoid delays is to use 9E (Endeavor Air) and US (US Airways).
